<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<style>
.header img {
  float: left;
  width: 75px;
  height: 75px;
  vertical-align: middle
  background: #FFF;
}
.header h1 {
  position: relative;
  top: 18px;
  left: 0px;
}
</style>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="shortcut icon" type="image/jpg" href="marionette.jpg" />
  <title>"See the Strings"</title>
</head>
<body background="">
  <div class="header">
    <img src="marionette.jpg" alt="logo" />
    <h1>"See the Strings"</h1>
  </div>
  <br>
  <p>
  This tool makes it possible to generate <a href="http://en.wikipedia.org/wiki/Graph_drawing">
  graph drawings</a> to visualize the contributions and expenditures made by Political Action
  Committees (PACs) during the 2014 U.S. Congressional campaign cycle. These drawings represent
  PACs and candidates as "nodes", and the cash flows between them as "links" connecting the nodes.
  </p>
  <p>
  A political action committee exists to raise and spend money for and against political candidates,
  in order to advance the political interests of its backers. It may represent a corporation (e.g.,
  AT&T), a trade association ("National Association of Realtors"), or an ideological point of
  view ("Citizens for Lower Taxes").
  </p>
  <p>
  Direct contributions from PACs to candidate committees (e.g., "Nancy Pelosi for Congress") are
  subject to <a href="http://www.fec.gov/pages/brochures/contriblimits.shtml">strict limits</a>.
  However, a new kind of political action committee known as "Super PACs" came into existence in
  2010. Super PACs are allowed to raise and spend <i>unlimited</i> amounts of money to advocate for
  or against political candidates, but they are prohibited from contributing money directly to
  candidate committees. The expenditures made by Super PACs are sometimes referred to as "indirect
  contributions".
  </p>
  <p>
  The drawings generated by this tool represent both direct and indirect contributions as links
  between the nodes representing PACs and candidates.
  </p>
  <p>
  This tool is powered by campaign data provided by the <a href="http://www.opensecrets.org">
  Center for Responsive Politics</a>.
  </p>
  <p>
  Your feedback is valuable! Send questions and comments to 
  <a href="mailto:contact@seethestrings.org">contact@seethestrings.org</a>.
  </p>
  <hr>
  <h2>Ready to build your visualization?</h2>
  Let's get started then.
  <br><br>
  <form id="graphForm" action="graph.html" method="GET" target="blank_">
    <b>Do you want to see contributions to a particular candidate, or <i>from</i> a particular
    political action committee?</b>
    <br>
    <input type="radio" name="seedType" id="candidateButton" value="Candidate"
        onclick="updateSeedType()" checked="true">
      Candidate
    <input type="radio" name="seedType" id="pacButton" value="PAC"
        onclick="updateSeedType()">
      Political action committee
    <br><br>
    <div id="candidateFormSection" style="display:none">
      Which candidates' 2014 campaign contributions would you like to see? (Select one or more.)
      <br>
      <select name="candidates" id="candidatesList" multiple="multiple" size=1>
      </select>
    </div>
    <div id="pacFormSection" style="display:none">
      Which political action committees' 2014 campaign contributions would you like to see?
      (Select one or more.)
      <br>
      <select name="pacs" id="pacsList" multiple="multiple" size=1>
      </select>
    </div>
    <br><br>
    <div id="detailsFormSection" style="display:none">
      Would you like to see the contributions for each candidate <i>separately</i>, or for all of the
      selected candidates <i>combined</i>?
      <br>
      <input type="radio" name="groupCandidatesBy" value="Candidate" checked="true">
        Separate
      <br>
      <input type="radio" name="groupCandidatesBy" value="Selection">
        Combined
      <br><br>
      How would you like their contributions to be aggregated?
      <br>
      <input type="radio" name="groupContributionsBy" value="PAC" checked="true">
        By individual Political Action Committee
      <br>
      <input type="radio" name="groupContributionsBy" value="Industry">
        By industry (aggregated)
      <br>
      <input type="radio" name="groupContributionsBy" value="Sector">
        By sector (more aggregated)
      <br><br>
      Which contribution types would you like to see?
      <br>
      <input type="checkbox" name="contributionTypes" value="'D'" checked="true">
        Direct contributions to candidate committees
      <br>
      <input type="checkbox" name="contributionTypes" value="'I'" checked="true">
        Indirect expenditures to influence candidates' election prospects
      <br><br><br><br>
      <input type="button" style="width:400px;font-size:16pt"
          onclick="document.getElementById('graphForm').submit()" value="See the contributions!">
      <br><br><br><br>
    </div>
  </form>
</body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

function addOptionToSelectBox(selectbox, text, value) {
  var option = document.createElement("OPTION");
  option.text = text;
  option.value = value;
  selectbox.options.add(option);
}

console.log("Trying to fetch candidates list from HTML page...");
d3.json("/candidates", showCandidates);

console.log("Trying to fetch PACs list from HTML page...");
d3.json("/pacs", showPacs);

updateSeedType();

function updateSeedType() {
  console.log("Updating seed type.")
  var candidateButton = document.getElementById("candidateButton");
  var pacButton = document.getElementById("pacButton");
  var candidateFormSection = document.getElementById("candidateFormSection");
  var pacFormSection = document.getElementById("pacFormSection");
  if (candidateButton.checked == true) {
    console.log("Candidate mode");
    candidateFormSection.style.display = "inline";
    pacFormSection.style.display = "none";
    // Clear existing selection of PACs.
    document.getElementById("pacsList").value = null;
  }
  if (pacButton.checked == true) {
    console.log("PAC mode");
    candidateFormSection.style.display = "none";
    pacFormSection.style.display = "inline";
    // Clear existing selection of Candidates.
    document.getElementById("candidatesList").value = null;
  }
  var detailsFormSection = document.getElementById("detailsFormSection");
  detailsFormSection.style.display = "inline";
}

function showCandidates(err, candidates) {
  if (err != null) {
    console.log("Error fetching candidates list from HTML page: " + JSON.stringify(err));
    // TODO: What should we do here?
  } else {
    console.log("Got a list of " + candidates.length + " candidates on HTML page");
  }

  var selectBox = document.getElementById("candidatesList");
  candidates.forEach(
      function(row) {
        addOptionToSelectBox(selectBox, row.firstlastp, "'" + row.cid + "'");
      });
  selectBox.setAttribute("size", 20);
}

function showPacs(err, pacs) {
  if (err != null) {
    console.log("Error fetching PACs list from HTML page: " + JSON.stringify(err));
    // TODO: What should we do here?
  } else {
    console.log("Got a list of " + pacs.length + " PACs on HTML page");
  }

  var selectBox = document.getElementById("pacsList");
  pacs.forEach(
      function(row) {
        addOptionToSelectBox(selectBox, row.pacshort, "'" + row.pacid + "'");
      });
  selectBox.setAttribute("size", 20);
}

</script>
</html>